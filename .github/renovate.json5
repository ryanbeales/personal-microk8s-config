{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",

  extends: [
    "config:recommended"
  ],

  // Define a custom manager that will look for a comment above the version dependnency line and contain details on how to update it
  customManagers: [
    // Define a custom regex manager to find annotated dependencies in deployment, Kustomization and values files
    {
      // Documentation here https://docs.renovatebot.com/modules/manager/regex/
      customType: "regex",
      description: "Annotated dependencies in deployment, Kustomization and values files",
      managerFilePatterns: [
        "**/deployment.y?ml",
        "**/daemonset.y?ml",
        "**/cronjob.y?ml",
        "**/*-values.y?ml",
        "**/values-*.y?ml",
        "**/values.y?ml",
      ],
      matchStrings: [
        // Use in image tag lines or in values files
        // Examples:
        //   renovate: datasource=github-tags depname=blakeblackshear/frigate versioning=docker
        //   tag: 0.16.1-tensorrt
        //   renovate: datasource=github-tags depname=esphome/esphome versioning=semver
        //   image: esphome/esphome:2025.8.4
        "# renovate: datasource=(?<datasource>.*?) depname=(?<depName>.*?)( versioning=(?<versioning>.*?))?\\s+\\S+?:\\s(\\S+?:)?(?<currentValue>\\S+)",
      ],
      versioningTemplate: "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}",
    },

    // Matchers for kustomization files
    {
      customType: "regex",
      description: "Direct GitHub references",
      managerFilePatterns: [
        "**/kustomization.yaml",
        "**/Kustomization"
      ],
      matchStrings: [
        // Example: https://raw.githubusercontent.com/argoproj/argo-cd/v3.1.5/manifests/install.yaml
        "# renovate: datasource=(?<datasource>.*?) depname=(?<depName>.*?)( versioning=(?<versioning>.*?))?\\s+-\\s\\S+?raw\\.githubusercontent\\.com\\/\\S+?\\/\\S+?\\/(?<currentValue>\\S+?)\\/",
      ],
      versioningTemplate: "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}",
    },
  ],

  // Allow automatic merging for some "safe" dependencies. Argocd is in there, I think that's fine...
  packageRules: [
    {
      matchDepNames: [
        "renovatebot/renovate", 
        "esphome/esphome",
        "argoproj/argo-cd",
        "ollama/ollama",
        "Octoprint/octoprint"
      ],
      automerge: true
    }
  ],

  ignoreDeps: [
    // Ignore all other dependencies not matched by the custom regex manager
    "postgresql"
  ],

  ignorePaths: [
    // Ignore any files in the archived directory
    "archived/**"
  ],
}